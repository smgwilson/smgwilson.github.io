<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Device Tester</title>
    <script>
        function getIOSVersion(ua) {
            if (/iP(hone|ad)/i.test(ua)) {
                return ua.match(/OS [\d_]+/i)[0].substr(3).split('_').map(n => parseInt(n));
            }
            return [0];
        }

        function getIsIphone(ua) {
            return !(/iPad/i.test(ua));
        }

        function getiPhoneModelWebGl() {
            // Create a canvas element which can be used to retrieve information about the GPU.
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
            const info = context.getExtension("WEBGL_debug_renderer_info");
            const renderer = context.getParameter(info.UNMASKED_RENDERER_WEBGL);

            const displayValues = {
                type: "",
                message: ""
            };

            const displayTypes = {
                OBSOLETE: "PoC- iOS Old Device Message.FPO",
                UNDETERMINED: "undetermined",
                CURRENT: "PoC-iOS New Device Message to upgrade. FPO",
                UNKNOWN: "Unknown model"

            };
            // iPhone 12
            if ((window.screen.height / window.screen.width === 926 / 428) && (window.devicePixelRatio === 3)) {
                displayValues.type = "iPhone 12 Pro Max";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
            } else if ((window.screen.height / window.screen.width === 844 / 390) && (window.devicePixelRatio === 3)) {
                displayValues.type = "iPhone 12 or 12 Pro";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
            } else if ((window.screen.height / window.screen.width === 780 / 360) && (window.devicePixelRatio === 3)) {
                displayValues.type = "iPhone 12 Mini";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
            }
            // iPhone 11
            else if ((window.screen.height / window.screen.width === 896 / 414) && (window.devicePixelRatio === 3)) {
                displayValues.type = "iPhone 11 Pro Max or Xs Max";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
            } else if ((window.screen.height / window.screen.width === 896 / 414) && (window.devicePixelRatio === 2)) {
                displayValues.type = "iPhone 11 or XR";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
                // iPhone X
            } else if ((window.screen.height / window.screen.width === 812 / 375) && (window.devicePixelRatio === 3)) {
                displayValues.type = "iPhone 11 Pro, X or Xs";
                displayValues.message = displayTypes['CURRENT'];
                return displayValues;
            }
            // iPhone 6+/6s+/7+ and 8+
            else if ((window.screen.height / window.screen.width === 736 / 414) && (window.devicePixelRatio === 3)) {
                switch (renderer) {
                    case "Apple A8 GPU":
                        displayValues.type = "iPhone 6 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A9 GPU":
                        displayValues.type = "iPhone 6s Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A10 GPU":
                        displayValues.type = "iPhone 7 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A11 GPU":
                        displayValues.type = "iPhone 8 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 6 Plus, 6s Plus, 7 Plus or 8 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                }
                // iPhone 6+/6s+/7+ and 8+ in zoom mode
            } else if ((window.screen.height / window.screen.width === 667 / 375) && (window.devicePixelRatio === 3)) {
                switch (renderer) {
                    case "Apple A8 GPU":
                        displayValues.type = "iPhone 6 Plus (display zoom)";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A9 GPU":
                        displayValues.type = "iPhone 6s Plus (display zoom)";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A10 GPU":
                        displayValues.type = "iPhone 7 Plus (display zoom)";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    case "Apple A11 GPU":
                        displayValues.type = "iPhone 6 Plus, 6s Plus, 7 Plus or 8 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 6 Plus, 6s Plus, 7 Plus or 8 Plus";
                        displayValues.message = displayTypes['CURRENT'];
                        return displayValues;
                }
                // iPhone 6/6s/7 and 8
            } else if ((window.screen.height / window.screen.width === 667 / 375) && (window.devicePixelRatio === 2)) {
                switch (renderer) {
                    case "Apple A8 GPU":
                        displayValues.type = "iPhone 6";
                        displayValues.message = displayTypes['UNDETERMINED'];
                        return displayValues;
                    case "Apple A9 GPU":
                        displayValues.type = "iPhone 6s";
                        displayValues.message = displayTypes['UNDETERMINED'];
                        return displayValues;
                    case "Apple A10 GPU":
                        displayValues.type = "iPhone 7";
                        displayValues.message = displayTypes['UNDETERMINED'];
                        return displayValues;
                    case "Apple A11 GPU":
                        displayValues.type = "iPhone 8";
                        displayValues.message = displayTypes['UNDETERMINED'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 6, 6s, 7 or 8";
                        displayValues.message = displayTypes['UNDETERMINED'];
                        return displayValues;
                }
                // iPhone 5/5C/5s/SE or 6/6s/7 and 8 in zoom mode
            } else if ((window.screen.height / window.screen.width === 1.775) && (window.devicePixelRatio === 2)) {
                switch (renderer) {
                    case "PowerVR SGX 543":
                        displayValues.type = "iPhone 5 or 5c";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "Apple A7 GPU":
                        displayValues.type = "iPhone 5s";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "Apple A8 GPU":
                        displayValues.type = "iPhone 6 (display zoom)";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "Apple A9 GPU":
                        displayValues.type = "iPhone SE or 6s (display zoom)";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "Apple A10 GPU":
                        displayValues.type = "iPhone 7 (display zoom)";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "Apple A11 GPU":
                        displayValues.type = "iPhone 8 (display zoom)";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 5, 5C, 5S, SE or 6, 6s, 7 and 8 (display zoom)";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                }
                // iPhone 4/4s
            } else if ((window.screen.height / window.screen.width === 1.5) && (window.devicePixelRatio === 2)) {
                switch (renderer) {
                    case "PowerVR SGX 535":
                        displayValues.type = "iPhone 4";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "PowerVR SGX 543":
                        displayValues.type = "iPhone 4s";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 4 or 4s";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                }
                // iPhone 1/3G/3GS
            } else if ((window.screen.height / window.screen.width === 1.5) && (window.devicePixelRatio === 1)) {
                switch (renderer) {
                    case "ALP0298C05":
                        displayValues.type = "iPhone 3GS";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    case "S5L8900":
                        displayValues.type = "iPhone 1, 3G";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                    default:
                        displayValues.type = "iPhone 1, 3G or 3GS";
                        displayValues.message = displayTypes['OBSOLETE'];
                        return displayValues;
                }
            } else {
                displayValues.type = "Unknown";
                displayValues.message = displayTypes['UNKNOWN'];
                return displayValues;
            }
        };


        function getDeviceDetails() {
            const agent = navigator.userAgent;
            console.log("agent", agent);
            // logic constants
            const isAndroid = !!agent.match(/Android/i);
            const isIOS = !!agent.match(/iP(hone|ad)/i);

            // nodes
            const messageNode = document.getElementById("message");
            const downloadNode = document.getElementById("download");
            const androidDownloadNode = document.getElementById("download-android");
            const iOSDownloadNode = document.getElementById("download-iOS");
            const iOSModelSelection = document.getElementById("model-selection");

            if (isIOS) {      
                iOSModelSelection.style.display = "none";
                androidDownloadNode.style.display = "none";

                const iOSVersion = getIOSVersion(agent);
                console.log("iOSVersion", iOSVersion);
                const isiPhone = getIsIphone(agent);
                console.log("isIPhone", isiPhone);
                if (isiPhone) {
                  OS_TRIGGER_VALUE = 12;
                  const modelInfo = getiPhoneModelWebGl();
                  const currentModel = iOSVersion[0] > OS_TRIGGER_VALUE;
                  const unknownModel = modelInfo.message === "undetermined";
                  // An unknown model could be 6, 6s, 7, or 8, but we know it's above 6 if the OS is upgraded. 
                    if (unknownModel && !currentModel) { 
                      messageNode.style.display = "";
                      downloadNode.style.display = "none";
                      iOSModelSelection.style.display = "block";
                    } else if (unknownModel && currentModel) {
                      messageNode.innerHTML = "PoC-iOS New Device Message to upgrade. FPO";
                      iOSModelSelection.style.display = "none"; 
                      iOSDownloadNode.style.display = "inline";
                      iOSDownloadNode.innerHTML = "Download Walmart";
                    } else if (currentModel && !unknownModel) {
                      messageNode.innerHTML = modelInfo.message;
                      iOSModelSelection.style.display = "none"; 
                      iOSDownloadNode.style.display = "inline";
                      iOSDownloadNode.innerHTML = "Download Walmart";
                    }else {
                      messageNode.innerHTML = modelInfo.message;
                      iOSModelSelection.style.display = "none"; 
                      iOSDownloadNode.style.display = "none";
                    }
                } else {
                    messageNode.innerHTML = "PoC-iOS New Device Message to upgrade. FPO";
                    androidDownloadNode.style.display = "none";
                    iOSDownloadNode.innerHTML = "Download Walmart";
                    iOSDownloadNode.style.display = "inline";
                }
            } else if (isAndroid) {
                messageNode.innerHTML = "PoC-Android Generic Message. FPO";
                androidDownloadNode.innerHTML = "Download Android";
                iOSDownloadNode.style.display = "none";
                iOSModelSelection.style.display = "none";
                androidDownloadNode.style.display = "inline";
            } else {
                messageNode.innerHTML = "PoC-Generic error. FPO";
                androidDownloadNode.innerHTML = "Download Walmart for Android";
                iOSDownloadNode.innerHTML = "Download Walmart for iOS";
                iOSDownloadNode.style.display = "inline";
                androidDownloadNode.style.display = "inline";
                iOSModelSelection.style.display = "none";
            }
        }

        function showHide (id) {
            if (id === "current") {
                document.getElementById("message").innerHTML = "PoC-iOS New Device Message to upgrade. FPO"
                document.getElementById("download-iOS").style.display = "inline";
                document.getElementById("download-iOS").innerHTML = "Download Walmart";
            } else {
                document.getElementById("message").innerHTML  = "PoC- iOS Old Device Message.FPO";
                document.getElementById("download-iOS").style.display = "none";
            }
        }
    </script>
</head>

<body onload="getDeviceDetails()">
    <section id="model-selection">
    <p>Please select your iPhone model: </p>
      <input type="radio" id="current" name="model" value="6sPlus" onclick="showHide(id)">
        <label for="6sPlus">iPhone 6+/iPhone 7 or newer</label><br>
      <input type="radio" id="obsolete" name="model" value="LessThan6" onclick="showHide(id)">
        <label for="LessThan6">Older than iPhone 6+/iPhone 7</label><br>
    </section>
    <p id="message"></p>
    <section id="download">
        <div>
            <a
              href="https://play.google.com/store/apps/details?id=com.walmart.android" 
              id="download-android"
              rel="noopener noreferrer"
              target="_blank" >
            </a>
        </div>
        <div>
            <a 
              href="https://apps.apple.com/us/app/walmart-shopping-grocery/id338137227" 
              id="download-iOS"
              rel="noopener noreferrer"
              target="_blank" >
            </a>
        </div>
    </section>
</body>

</html>